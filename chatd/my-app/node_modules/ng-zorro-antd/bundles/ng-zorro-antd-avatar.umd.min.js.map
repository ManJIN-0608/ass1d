{"version":3,"sources":["ng://ng-zorro-antd/avatar/nz-avatar.component.ts","ng://ng-zorro-antd/avatar/nz-avatar.module.ts"],"names":["NzAvatarComponent","elementRef","cd","updateHostClassService","renderer","platform","this","nzShape","nzSize","nzError","EventEmitter","oldAPIIcon","hasText","hasSrc","hasIcon","el","nativeElement","prefixCls","sizeMap","large","small","prototype","setClass","classMap","_a","nzIcon","updateHostClass","detectChanges","imgError","$event","emit","defaultPrevented","nzText","notifyCalc","setSizeStyle","ngOnChanges","changes","hasOwnProperty","currentValue","indexOf","nzSrc","calcStringSize","childrenWidth","textEl","offsetWidth","avatarWidth","getBoundingClientRect","width","scale","textStyles","transform","Object","assign","lineHeight","_this","isBrowser","setTimeout","size","setStyle","Component","args","selector","exportAs","template","providers","NzUpdateHostClassService","preserveWhitespaces","changeDetection","ChangeDetectionStrategy","OnPush","encapsulation","ViewEncapsulation","None","ElementRef","ChangeDetectorRef","Renderer2","Platform","Input","Output","ViewChild","static","NzAvatarModule","NgModule","declarations","exports","imports","CommonModule","NzIconModule","PlatformModule"],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright Alibaba.com All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://github.com/NG-ZORRO/ng-zorro-antd/blob/master/LICENSE\n */\n\nimport { Platform } from '@angular/cdk/platform';\nimport {\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  ElementRef,\n  EventEmitter,\n  Input,\n  OnChanges,\n  Output,\n  Renderer2,\n  SimpleChanges,\n  ViewChild,\n  ViewEncapsulation\n} from '@angular/core';\n\nimport { NzSizeLDSType, NzSizeMap, NzUpdateHostClassService } from 'ng-zorro-antd/core';\n\nexport type NzAvatarShape = 'square' | 'circle';\nexport type NzAvatarSize = NzSizeLDSType | number;\n\nexport interface NzAvatarSizeMap {\n  [size: string]: string;\n}\n\n@Component({\n  selector: 'nz-avatar',\n  exportAs: 'nzAvatar',\n  templateUrl: './nz-avatar.component.html',\n  providers: [NzUpdateHostClassService],\n  preserveWhitespaces: false,\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  encapsulation: ViewEncapsulation.None\n})\nexport class NzAvatarComponent implements OnChanges {\n  @Input() nzShape: NzAvatarShape = 'circle';\n  @Input() nzSize: NzAvatarSize = 'default';\n  @Input() nzText: string;\n  @Input() nzSrc: string;\n  @Input() nzSrcSet: string;\n  @Input() nzAlt: string;\n  @Input() nzIcon: string;\n  @Output() readonly nzError = new EventEmitter<Event>();\n\n  oldAPIIcon = true; // Make the user defined icon compatible to old API. Should be removed in 2.0.\n  hasText: boolean = false;\n  hasSrc: boolean = true;\n  hasIcon: boolean = false;\n  textStyles: {};\n\n  @ViewChild('textEl', { static: false }) textEl: ElementRef;\n\n  private el: HTMLElement = this.elementRef.nativeElement;\n  private prefixCls = 'ant-avatar';\n  private sizeMap: NzSizeMap = { large: 'lg', small: 'sm' };\n\n  constructor(\n    private elementRef: ElementRef,\n    private cd: ChangeDetectorRef,\n    private updateHostClassService: NzUpdateHostClassService,\n    private renderer: Renderer2,\n    private platform: Platform\n  ) {}\n\n  setClass(): this {\n    const classMap = {\n      [this.prefixCls]: true,\n      [`${this.prefixCls}-${this.sizeMap[this.nzSize]}`]: this.sizeMap[this.nzSize],\n      [`${this.prefixCls}-${this.nzShape}`]: this.nzShape,\n      [`${this.prefixCls}-icon`]: this.nzIcon,\n      [`${this.prefixCls}-image`]: this.hasSrc // downgrade after image error\n    };\n    this.updateHostClassService.updateHostClass(this.el, classMap);\n    this.cd.detectChanges();\n    return this;\n  }\n\n  imgError($event: Event): void {\n    this.nzError.emit($event);\n    if (!$event.defaultPrevented) {\n      this.hasSrc = false;\n      this.hasIcon = false;\n      this.hasText = false;\n      if (this.nzIcon) {\n        this.hasIcon = true;\n      } else if (this.nzText) {\n        this.hasText = true;\n      }\n      this.setClass().notifyCalc();\n      this.setSizeStyle();\n    }\n  }\n\n  ngOnChanges(changes: SimpleChanges): void {\n    if (changes.hasOwnProperty('nzIcon') && changes.nzIcon.currentValue) {\n      this.oldAPIIcon = changes.nzIcon.currentValue.indexOf('anticon') > -1;\n    }\n    this.hasText = !this.nzSrc && !!this.nzText;\n    this.hasIcon = !this.nzSrc && !!this.nzIcon;\n    this.hasSrc = !!this.nzSrc;\n\n    this.setClass().notifyCalc();\n    this.setSizeStyle();\n  }\n\n  private calcStringSize(): void {\n    if (!this.hasText) {\n      return;\n    }\n\n    const childrenWidth = this.textEl.nativeElement.offsetWidth;\n    const avatarWidth = this.el.getBoundingClientRect().width;\n    const scale = avatarWidth - 8 < childrenWidth ? (avatarWidth - 8) / childrenWidth : 1;\n    this.textStyles = {\n      transform: `scale(${scale}) translateX(-50%)`\n    };\n    if (typeof this.nzSize === 'number') {\n      Object.assign(this.textStyles, {\n        lineHeight: `${this.nzSize}px`\n      });\n    }\n    this.cd.detectChanges();\n  }\n\n  private notifyCalc(): this {\n    // If use ngAfterViewChecked, always demands more computations, so......\n    if (this.platform.isBrowser) {\n      setTimeout(() => {\n        this.calcStringSize();\n      });\n    }\n    return this;\n  }\n\n  private setSizeStyle(): void {\n    const size = typeof this.nzSize === 'string' ? this.nzSize : `${this.nzSize}px`;\n    this.renderer.setStyle(this.el, 'width', size);\n    this.renderer.setStyle(this.el, 'height', size);\n    this.renderer.setStyle(this.el, 'line-height', size);\n    if (this.hasIcon) {\n      this.renderer.setStyle(this.el, 'font-size', `calc(${size} / 2)`);\n    }\n  }\n}\n","/**\n * @license\n * Copyright Alibaba.com All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://github.com/NG-ZORRO/ng-zorro-antd/blob/master/LICENSE\n */\nimport { PlatformModule } from '@angular/cdk/platform';\nimport { CommonModule } from '@angular/common';\nimport { NgModule } from '@angular/core';\nimport { NzIconModule } from 'ng-zorro-antd/icon';\n\nimport { NzAvatarComponent } from './nz-avatar.component';\n\n@NgModule({\n  declarations: [NzAvatarComponent],\n  exports: [NzAvatarComponent],\n  imports: [CommonModule, NzIconModule, PlatformModule]\n})\nexport class NzAvatarModule {}\n"]}